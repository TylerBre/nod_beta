/*! Nod 2013-11-18, by Gorm Casper */
!function(window,undefined){"use strict";function newListener(args){function delayedCheck(){clearTimeout(delayId),delayId=setTimeout(checkValue,args.options.delay)}function checkValue(a,b){"clear"===b?changeStatus(!0):$.when(check(getVal())).done(changeStatus)}function changeStatus(isCorrect){try{isCorrect=eval(isCorrect)}catch(e){}isCorrect=!!isCorrect,status!==isCorrect&&(status=isCorrect,msg(status),$(l).trigger("nodToggle",[$el,$el.showValidText]),"one-of"===validate&&status&&$(window).trigger("nod-run-one-of"))}var status=null,$el=args.$el,validate=args.metric.validate,check=new Checker(validate),msg=new Msg($el,args.metric,args.options),getVal=new GetVal($el,args.metric),delayId="",l={$el:$el};return $el.on("keyup",delayedCheck),$el.on("blur change nodCheck",checkValue),sameAsEvent(validate,delayedCheck),oneOfEvent(validate,checkValue),l}function GetVal(a,b){switch(a.attr("type")){case"checkbox":return function(){return a.is(":checked")};case"radio":var c=a.attr("name");return function(){return $('[name="'+c+'"]').filter(":checked").val()};default:if("one-of"!==b[1])return function(){return $.trim(a.val())};var d=$(b[0]);return function(){return d.map(function(){return $.trim(this.value)}).get().join("")}}}function sameAsEvent(a,b){a&&a.constructor&&a.call&&a.apply||(a=a.split(":"),"same-as"===a[0]&&$(a[1]).on("keyup",b))}function oneOfEvent(a,b){"one-of"===a&&$(window).on("nod-run-one-of",b)}function Msg(a,b,c){function d(a){a?f.remove():g(f)}var e=c.errorPosClasses,f=new $Msg(b.errorText,c.helpSpanDisplay,c.nodClass),g=new ShowMsg(e,a),h=newShowValidText(c);return a.showValidText=h,d}function $Msg(a,b,c){return $("<span/>",{html:a,"class":b+" "+c})}function elHasClass(a,b,c){var d=!1;return each(function(a){c[b](a).length&&(d=!0)},a),d}function findPosition(a,b){return elHasClass(a,"parent",b)?findPosition(a,b.parent()):elHasClass(a,"next",b)?findPosition(a,b.next()):b}function ShowMsg(a,b){var c=b.attr("type");if("checkbox"===c||"radio"===c)return function(a){b.parent().append(a)};var d=findPosition(a,b);return function(a){d.after(a)}}function newShowValidText(a){return function(){console.log(a)}}function Checker(a){if(a&&a.constructor&&a.call&&a.apply)return a;if(a instanceof RegExp)return function(b){return a.test(b)};var b=a.split(":"),c=b[0],d=b[1],e=b[2];if("same-as"===c&&1!==$(d).length)throw new Error("same-as selector must target one and only one element");switch(c){case"presence":case"one-of":return function(a){return!!a};case"empty":return function(a){return 0===a.length||!1};case"exact":return function(a){return a===d};case"not":return function(a){return a!==d};case"same-as":return function(a){return a===$(d).val()};case"min-length":return function(a){return a.length>=+d};case"max-length":return function(a){return a.length<=+d};case"exact-length":return function(a){return a.length===+d};case"between":return function(a){return a.length>=+d&&a.length<=+e};case"integer":return function(a){return/^\s*\d+\s*$/.test(a)};case"min-num":return function(a){return+a>=+d};case"max-num":return function(a){return+d>=+a};case"between-num":return function(a){return+a>=+d&&+e>=+a};case"float":return function(a){return/^[-+]?[0-9]+(\.[0-9]+)?$/.test(a)};case"email":return function(a){var b=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;return b.test(a)};default:throw new Error("I don't know how to check for: "+c)}}function elsHaveErrors(a){a=a?$(a):$els;var b=!1;return a.each(function(){elHasErrors(this)&&(b=!0)}),b}function getGroup(a){return $(a).parents(options.groupSelector)}function groupHasErrors(a){return!empty(a.find("."+options.nodClass))}function ToggleSubmit(a){if(!a)return function(){};var b=$(a);return function(a){switch(a){case"on":return disableSubmit(b,!1);case"off":return disableSubmit(b,!0);default:return disableSubmit(b,elsHaveErrors())}}}function disableSubmit(a,b){a.toggleClass("disabled",b).prop("disabled",b)}function toggleGroupClass(a,b){var c=b[0],d=(b[1],getGroup(c)),e=groupHasErrors(d);d.toggleClass(options.errorClass,e).toggleClass(options.successClass,!e),e||b.showValidText()}function attachEvents(a,b){return function(c){each(function(b){$(c).on(a,b)},b)}}function nod(a,b){return a&&!empty(a)?(metrics=a,options=extend(defaultOptions,b),$els=get$Els(metrics),listeners=map(newListener,getListenerArgs(metrics)),toggleSubmit=new ToggleSubmit(options.submitBtn),each(attachEvents("nodToggle",[toggleSubmit,toggleGroupClass]),listeners),{toggleSubmit:toggleSubmit}):void 0}var metrics,options,$els,listeners,defaultOptions={form:null,submitBtn:null,delay:700,helpSpanDisplay:"help-inline",errorClass:"error",errorPosClasses:[".help-inline",".add-on","button",".input-append"],silentSubmit:!1,broadcastError:!1,nodClass:"nodMsg",successClass:"",groupSelector:".control-group"},getListenerArgs=foldl(function(a,b){return $(b.selector).each(function(){a.push({$el:$(this),metric:b,options:options})}),a},[]),get$Els=compose($,unique,map(dot("selector"))),elHasErrors=compose(groupHasErrors,getGroup),toggleSubmit;window.nod=nod}(window);